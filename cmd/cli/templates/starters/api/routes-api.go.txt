package main

import (
	"os"

	v1 "${APP_NAME}/handlers/api/v1"
	"${APP_NAME}/middleware"

	"github.com/go-chi/chi/v5"
)

// apiRoutes sets up API routes with versioning
func apiRoutes(mux *chi.Mux) {
	jwtSecret := os.Getenv("JWT_SECRET")
	if jwtSecret == "" {
		jwtSecret = "your-secret-key-change-in-production"
	}

	authHandler := &v1.AuthHandler{JWTSecret: jwtSecret}
	resourceHandler := &v1.ResourceHandler{}

	// API v1 routes
	mux.Route("/api/v1", func(r chi.Router) {
		// CORS for API
		r.Use(middleware.CORS([]string{"*"}))

		// Public routes
		r.Post("/auth/login", authHandler.Login)

		// Protected routes
		r.Group(func(r chi.Router) {
			r.Use(middleware.JWTAuth(jwtSecret))

			// Token refresh
			r.Post("/auth/refresh", authHandler.Refresh)

			// Resources CRUD
			r.Get("/resources", resourceHandler.List)
			r.Post("/resources", resourceHandler.Create)
			r.Get("/resources/{id}", resourceHandler.Get)
			r.Put("/resources/{id}", resourceHandler.Update)
			r.Delete("/resources/{id}", resourceHandler.Delete)
		})
	})
}
